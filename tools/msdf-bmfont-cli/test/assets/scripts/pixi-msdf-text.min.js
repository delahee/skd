!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MSDFText=t():e.MSDFText=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,o){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(1);t.MSDFText=o.MSDFText;var n=r(2);t.MSDFRenderer=n.MSDFRenderer},function(e,t,r){"use strict";var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(t,r){var o=e.call(this,r.texture||PIXI.Texture.WHITE)||this;return o._text=t,o._font={fontFace:r.fontFace,fontSize:r.fontSize,color:void 0===r.fillColor?16711680:r.fillColor,weight:void 0===r.weight?.5:1-r.weight,align:r.align,kerning:void 0===r.kerning||r.kerning,strokeColor:r.strokeColor||0,dropShadow:r.dropShadow||!1,dropShadowColor:r.dropShadowColor||0,dropShadowAlpha:void 0===r.dropShadowAlpha?.5:r.dropShadowAlpha,dropShadowBlur:r.dropShadowBlur||0,dropShadowOffset:r.dropShadowOffset||new PIXI.Point(2,2),pxrange:void 0===r.pxrange?3:r.pxrange},void 0===r.strokeThickness||0===r.strokeThickness?o._font.strokeWeight=0:o._font.strokeWeight=o._font.weight-r.strokeThickness,o._baselineOffset=void 0===r.baselineOffset?0:r.baselineOffset,o._letterSpacing=void 0===r.letterSpacing?0:r.letterSpacing,o._lineSpacing=void 0===r.lineSpacing?0:r.lineSpacing,o._textWidth=o._textHeight=0,o._maxWidth=r.maxWidth||0,o._anchor=new PIXI.ObservablePoint(function(){o.dirty++},o,0,0),o._textMetricsBound=new PIXI.Rectangle,o._debugLevel=r.debugLevel||0,o.pluginName="msdf",o.dirty=0,o.updateText(),o}return o(t,e),t.prototype.updateText=function(){this.removeChildren();var e=PIXI.extras.BitmapText.fonts[this._font.fontFace];if(!e)throw new Error("Invalid fontFace: "+this._font.fontFace);this._texture=this.getBitmapTexture(this._font.fontFace),this._font.rawSize=e.size;for(var t=this._font.fontSize/e.size,r=new PIXI.Point(0,-this._baselineOffset*t),o=[],n=[],i=this._texture.width,a=this._texture.height,s=-1,h=0,u=0,d=0,f=-1,l=0,c=0,p=0,x=0;x<this._text.length;x++){var g=this._text.charCodeAt(x);if(/(\s)/.test(this._text.charAt(x))&&(f=x,l=h),/(?:\r\n|\r|\n)/.test(this._text.charAt(x)))h-=this._letterSpacing,n.push(h),u=Math.max(u,h),d++,r.x=0,r.y+=e.lineHeight*t+this._lineSpacing*t,s=-1;else if(-1!==f&&this._maxWidth>0&&r.x>this._maxWidth)PIXI.utils.removeItems(o,f-c,x-f),x=f,f=-1,++c,l-=this._letterSpacing,n.push(l),u=Math.max(u,l),d++,r.x=0,r.y+=e.lineHeight*t+this._lineSpacing*t,s=-1;else{var m=e.chars[g];m&&(this._font.kerning&&-1!==s&&m.kerning[s]&&(r.x+=m.kerning[s]*t),o.push({line:d,charCode:g,drawRect:new PIXI.Rectangle(r.x+m.xOffset*t,r.y+m.yOffset*t,m.texture.width*t,m.texture.height*t),rawRect:new PIXI.Rectangle(m.texture.orig.x,m.texture.orig.y,m.texture.width,m.texture.height)}),r.x+=(m.xAdvance+this._letterSpacing)*t,h=r.x,p=Math.max(p,r.y+e.lineHeight*t),s=g)}}n.push(h),u=Math.max(u,h);for(var w=[],x=0;x<=d;x++){var _=0;"right"===this._font.align?_=u-n[x]:"center"===this._font.align&&(_=(u-n[x])/2),w.push(_)}for(var v=(this.tint,-1),y=0,S=o;y<S.length;y++){var b=S[y];b.drawRect.x=b.drawRect.x+w[b.line],v!==b.line&&(v=b.line,this._debugLevel>1&&this.drawGizmoRect(new PIXI.Rectangle(b.drawRect.x-e.chars[b.charCode].xOffset*t,b.drawRect.y-e.chars[b.charCode].yOffset*t,n[v],e.lineHeight*t),1,65280,.5))}this._debugLevel>0&&this.drawGizmoRect(this.getLocalBounds(),1,16777215,.5),this._textWidth=u,this._textHeight=p,this._textMetricsBound=new PIXI.Rectangle(0,0,u,p),this.vertices=this.toVertices(o),this.uvs=this.toUVs(o,i,a),this.indices=this.createIndicesForQuads(o.length),this.dirty++,this.indexDirty++},Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){this._text=this.unescape(e),this.updateText()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontData",{get:function(){return this._font},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glDatas",{get:function(){return this._glDatas},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textWidth",{get:function(){return this._textWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textHeight",{get:function(){return this._textHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxWidth",{get:function(){return this._maxWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textMetric",{get:function(){return this._textMetricsBound},enumerable:!0,configurable:!0}),t.prototype.getBitmapTexture=function(e){var t=PIXI.extras.BitmapText.fonts[e];if(!t)return PIXI.Texture.EMPTY;var r=t.chars[Object.keys(t.chars)[0]].texture.baseTexture.imageUrl;return PIXI.utils.TextureCache[r]},t.prototype.toVertices=function(e){var t=this,r=new Float32Array(4*e.length*2),o=0;return e.forEach(function(e){var n=e.drawRect.x,i=e.drawRect.y,a=e.drawRect.width,s=e.drawRect.height;r[o++]=n,r[o++]=i,r[o++]=n,r[o++]=i+s,r[o++]=n+a,r[o++]=i+s,r[o++]=n+a,r[o++]=i,t._debugLevel>2&&t.drawGizmoRect(e.drawRect,1,170,.5)}),r},t.prototype.toUVs=function(e,t,r){var o=new Float32Array(4*e.length*2),n=0;return e.forEach(function(e){var i=e.rawRect.x/t,a=(e.rawRect.x+e.rawRect.width)/t,s=(e.rawRect.y+e.rawRect.height)/r,h=e.rawRect.y/r;o[n++]=i,o[n++]=h,o[n++]=i,o[n++]=s,o[n++]=a,o[n++]=s,o[n++]=a,o[n++]=h}),o},t.prototype.createIndicesForQuads=function(e){for(var t=6*e,r=new Uint16Array(t),o=0,n=0;o<t;o+=6,n+=4)r[o+0]=n+0,r[o+1]=n+1,r[o+2]=n+2,r[o+3]=n+0,r[o+4]=n+2,r[o+5]=n+3;return r},t.prototype.drawGizmoRect=function(e,t,r,o){void 0===t&&(t=1),void 0===r&&(r=16777215),void 0===o&&(o=1);var n=new PIXI.Graphics;n.nativeLines=!0,n.lineStyle(t,r,o).drawRect(e.x,e.y,e.width,e.height),this.addChild(n)},t.prototype.unescape=function(e){return e.replace(/(\\n|\\r)/g,"\n")},t}(PIXI.mesh.Mesh);t.MSDFText=n},function(e,t,r){"use strict";var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(4),a=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.onContextChange=function(){var e=this.renderer.gl;this.shader=new PIXI.Shader(e,n,i)},t.prototype.render=function(e){var t=this.renderer,r=e.texture,o=e.fontData,n=t.gl;if(r&&r.valid&&o.rawSize){var i=e.glDatas[t.CONTEXT_UID];i||(i={shader:this.shader,vertexBuffer:PIXI.glCore.GLBuffer.createVertexBuffer(n,e.vertices,n.STREAM_DRAW),uvBuffer:PIXI.glCore.GLBuffer.createVertexBuffer(n,e.uvs,n.STREAM_DRAW),indexBuffer:PIXI.glCore.GLBuffer.createIndexBuffer(n,e.indices,n.STATIC_DRAW),vao:null,dirty:e.dirty,indexDirty:e.indexDirty},i.vao=new PIXI.glCore.VertexArrayObject(n).addIndex(i.indexBuffer).addAttribute(i.vertexBuffer,i.shader.attributes.aVertexPosition,n.FLOAT,!1,8,0).addAttribute(i.uvBuffer,i.shader.attributes.aTextureCoord,n.FLOAT,!1,8,0),e.glDatas[t.CONTEXT_UID]=i),t.bindVao(i.vao),e.dirty!==i.dirty&&(i.dirty=e.dirty,i.uvBuffer.upload(e.uvs)),e.indexDirty!==i.indexDirty&&(i.indexDirty=e.indexDirty,i.indexBuffer.upload(e.indices)),i.vertexBuffer.upload(e.vertices),t.bindShader(i.shader),i.shader.uniforms.uSampler=t.bindTexture(r),t.state&&t.state.setBlendMode(e.blendMode),i.shader.uniforms.translationMatrix=e.worldTransform.toArray(!0),i.shader.uniforms.u_alpha=e.worldAlpha,i.shader.uniforms.u_color=PIXI.utils.hex2rgb(o.color),i.shader.uniforms.u_fontSize=o.fontSize*e.scale.x,i.shader.uniforms.u_fontInfoSize=1,i.shader.uniforms.u_weight=o.weight,i.shader.uniforms.u_pxrange=o.pxrange,i.shader.uniforms.strokeWeight=o.strokeWeight,i.shader.uniforms.strokeColor=PIXI.utils.hex2rgb(o.strokeColor),i.shader.uniforms.tint=PIXI.utils.hex2rgb(e.tint),i.shader.uniforms.hasShadow=o.dropShadow,i.shader.uniforms.shadowOffset=new Float32Array([o.dropShadowOffset.x,o.dropShadowOffset.x]),i.shader.uniforms.shadowColor=PIXI.utils.hex2rgb(o.dropShadowColor),i.shader.uniforms.shadowAlpha=o.dropShadowAlpha,i.shader.uniforms.shadowSmoothing=o.dropShadowBlur;var a=e.drawMode=n.TRIANGLES;i.vao.draw(a,e.indices.length,0)}},t}(PIXI.ObjectRenderer);t.MSDFRenderer=a,PIXI.WebGLRenderer.registerPlugin("msdf",a)},function(e,t){e.exports="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 translationMatrix;\nuniform mat3 projectionMatrix;\nuniform float u_fontInfoSize;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    vTextureCoord = aTextureCoord;\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition * u_fontInfoSize, 1.0)).xy, 0.0, 1.0);\n}\n"},function(e,t){e.exports="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform vec3 u_color;\nuniform sampler2D uSampler;\nuniform float u_alpha;\nuniform float u_fontSize;\nuniform float u_weight;\nuniform float u_pxrange;\n\nuniform vec3 tint;\n// Stroke effect parameters\nuniform float strokeWeight;\nuniform vec3 strokeColor;\n\n// Shadow effect parameters\nuniform bool hasShadow;\nuniform vec2 shadowOffset;\nuniform float shadowSmoothing;\nuniform vec3 shadowColor;\nuniform float shadowAlpha;\n\nfloat median(float r, float g, float b) {\n    return max(min(r, g), min(max(r, g), b));\n}\n\nvoid main(void)\n{\n    float smoothing = clamp(2.0 * u_pxrange / u_fontSize, 0.0, 0.5);\n\n    vec2 textureCoord = vTextureCoord * 2.;\n    vec3 sample = texture2D(uSampler, vTextureCoord).rgb;\n    float dist = median(sample.r, sample.g, sample.b);\n\n    float alpha;\n    vec3 color;\n\n    // dirty if statment, will change soon\n    if (strokeWeight > 0.0) {\n        alpha = smoothstep(strokeWeight - smoothing, strokeWeight + smoothing, dist);\n        float outlineFactor = smoothstep(u_weight - smoothing, u_weight + smoothing, dist);\n        color = mix(strokeColor, u_color, outlineFactor) * alpha;\n    } else {\n        alpha = smoothstep(u_weight - smoothing, u_weight + smoothing, dist);\n        color = u_color * alpha;\n    }\n    vec4 text = vec4(color * tint, alpha) * u_alpha;\n    if (hasShadow == false) {\n        gl_FragColor = text;\n    } else {\n        vec3 shadowSample = texture2D(uSampler, vTextureCoord - shadowOffset).rgb;\n        float shadowDist = median(shadowSample.r, shadowSample.g, shadowSample.b);\n        float distAlpha = smoothstep(0.5 - shadowSmoothing, 0.5 + shadowSmoothing, shadowDist);\n        vec4 shadow = vec4(shadowColor, shadowAlpha * distAlpha);\n        gl_FragColor = mix(shadow, text, text.a);\n    }\n}"}])});